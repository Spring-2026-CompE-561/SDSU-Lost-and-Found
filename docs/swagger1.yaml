openapi: 3.0.3
info:
  title: SDSU Lost & Found Backend API
  version: 1.0.0
  description: >
    REST API for SDSU Lost & Found â€” a campus web application that allows
    SDSU students and staff to report, search and recover lost items.
    Users can register/login, create and manage item posts, message other users,
    and track item status.

servers:
  - url: http://localhost:8000
    description: FastAPI backend

tags:
  - name: Auth
  - name: Users
  - name: Items
  - name: Chat

paths:
  /signup:
    post:
      summary: Register a new user
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthSignupRequest"
      responses:
        "200":
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthSignupResponse"
  /login:
    post:
      summary: Login and issue JWT
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthLoginRequest"
      responses:
        "200":
          description: Successful login
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthLoginResponse"
  /users/{id}:
    get:
      summary: Retrieve user profile
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            example: 1
      responses:
        "200":
          description: User information
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
    put:
      summary: Update user info
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserUpdateRequest"
      responses:
        "200":
          description: Update success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessUserResponse"
    delete:
      summary: Delete user account
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            example: 1
      responses:
        "200":
          description: Deletion confirmation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
  /users/{id}/token:
    get:
      summary: Retrieve users OAuth2 token
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            example: 1
      responses:
        "200":
          description: Token info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserToken"
    post:
      summary: Store or update user token
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserTokenUpsertRequest"
      responses:
        "200":
          description: Token saved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
  /home:
    get:
      summary: Retrieve item posts in database
      tags: [Items]
      security:
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
          description: Max number of posts to return
        - name: location
          in: query
          required: false
          schema:
            type: string
            example: "Library 2nd Floor"
          description: Optional filter by location
        - name: date
          in: query
          required: false
          schema:
            type: string
            format: date
            example: "2026-02-20"
          description: Optional filter by date (YYYY-MM-DD)
      responses:
        "200":
          description: List of item posts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Item"
    post:
      summary: Create a lost/found item post
      tags: [Items]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ItemCreateRequest"
      responses:
        "200":
          description: Created item post
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ItemCreateResponse"
  /home/{id}:
    get:
      summary: Retrieve a specific item post
      tags: [Items]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            example: 101
      responses:
        "200":
          description: Item post details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Item"
    put:
      summary: Update an item post
      tags: [Items]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            example: 101
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ItemUpdateRequest"
      responses:
        "200":
          description: Update success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
    delete:
      summary: Delete an item post
      tags: [Items]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            example: 101
      responses:
        "200":
          description: Deletion confirmation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
  /conversations:
    post:
      summary: Create or find a conversation between 2 users
      tags: [Chat]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConversationCreateRequest"
      responses:
        "200":
          description: Conversation created/found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Conversation"
    get:
      summary: List all active conversations for logged-in user
      tags: [Chat]
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of conversations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ConversationListItem"
  /conversations/{id}/messages:
    get:
      summary: Find message history for a conversation
      tags: [Chat]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            example: 10
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        "200":
          description: Message list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ChatMessage"
    post:
      summary: Send a new message in a conversation
      tags: [Chat]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            example: 10
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MessageSendRequest"
      responses:
        "200":
          description: Sent message
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatMessage"
  /messages/{id}:
    delete:
      summary: Delete a specific message
      tags: [Chat]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            example: 555
      responses:
        "200":
          description: Deletion confirmation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
components:
  schemas:
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "Validation error"
        detail:
          type: string
          example: "Field 'email' is required."
    AuthSignupRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          example: "student@sdsu.edu"
        password:
          type: string
          example: "mypassword123"
      required: [email, password]
    AuthSignupResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        userId:
          type: integer
          example: 1
    AuthLoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          example: "student@sdsu.edu"
        password:
          type: string
          example: "mypassword123"
      required: [email, password]
    AuthLoginResponse:
      type: object
      properties:
        token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        userId:
          type: integer
          example: 1
    User:
      type: object
      description: Registered user of the SDSU Lost & Found system
      properties:
        id:
          type: integer
          example: 1
        email:
          type: string
          format: email
          example: "student@sdsu.edu"
        password_hash:
          type: string
          example: "$2b$10$8df3e..."
        created_at:
          type: string
          format: date-time
          example: "2026-02-20T09:00:00Z"
    UserUpdateRequest:
      type: object
      properties:
        name:
          type: string
          example: "Jane Doe"
        email:
          type: string
          format: email
          example: "jane.doe@sdsu.edu"
    SuccessUserResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        user:
          $ref: "#/components/schemas/User"
    UserToken:
      type: object
      description: OAuth token data attached to a user 
      properties:
        id:
          type: integer
          example: 1
        user_id:
          type: integer
          example: 1
        created_at:
          type: string
          format: date-time
          example: "2026-02-20T09:10:00Z"
        getToken:
          type: string
          example: "access_token_here"
        refreshToken:
          type: string
          example: "refresh_token_here"
        expiryDate:
          type: string
          format: date-time
          example: "2026-03-20T09:10:00Z"
        tokenType:
          type: string
          example: "Bearer"
    UserTokenUpsertRequest:
      type: object
      properties:
        getToken:
          type: string
          example: "access_token_here"
        refreshToken:
          type: string
          example: "refresh_token_here"
        expiryDate:
          type: string
          format: date-time
          example: "2026-03-20T09:10:00Z"
        tokenType:
          type: string
          example: "Bearer"
      required: [tokenType]
    Item:
      type: object
      description: Lost/Found item post
      properties:
        id:
          type: integer
          example: 101
        user_id:
          type: integer
          example: 1
        title:
          type: string
          example: "Lost AirPods"
        description:
          type: string
          example: "White AirPods case. Might be near the library entrance."
        location:
          type: string
          example: "Library 2nd Floor"
        image_url:
          type: string
          example: "https://example.com/images/airpods.jpg"
        status:
          type: string
          description: Status of the item post
          enum: [Lost, Found, Returned]
          example: "Lost"
        given_back:
          type: boolean
          description: True if the item has been returned to its owner
          example: false
        created_at:
          type: string
          format: date-time
          example: "2026-02-20T10:00:00Z"
    ItemCreateRequest:
      type: object
      properties:
        title:
          type: string
          example: "Found Wallet"
        description:
          type: string
          example: "Black leather wallet found near parking structure."
        location:
          type: string
          example: "Parking Structure 3"
        image_url:
          type: string
          example: "https://example.com/images/wallet.jpg"
        status:
          type: string
          enum: [Lost, Found, Returned]
          example: "Found"
        time:
          type: string
          format: date-time
          example: "2026-02-20T12:30:00Z"
      required: [title, description, location, status]
    ItemCreateResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        item_id:
          type: integer
          example: 101
    ItemUpdateRequest:
      type: object
      properties:
        status:
          type: string
          enum: [Lost, Found, Returned]
          example: "Returned"
        given_back:
          type: boolean
          example: true
    Conversation:
      type: object
      properties:
        id:
          type: integer
          example: 10
        participant_ids:
          type: array
          items:
            type: integer
          example: [1, 7]
        created_at:
          type: string
          format: date-time
          example: "2026-02-20T11:00:00Z"
    ConversationListItem:
      type: object
      properties:
        id:
          type: integer
          example: 10
        last_message:
          type: string
          example: "Hi, I think I found your item."
        partner_name:
          type: string
          example: "Alex"

    ConversationCreateRequest:
      type: object
      properties:
        recipient_id:
          type: integer
          example: 7
      required: [recipient_id]

    ChatMessage:
      type: object
      properties:
        id:
          type: integer
          example: 555
        conversation_id:
          type: integer
          example: 10
        sender_id:
          type: integer
          example: 1
        content:
          type: string
          example: "Is this your wallet? I found it near P3"
        timestamp:
          type: string
          format: date-time
          example: "2026-02-20T11:05:00Z"
        is_read:
          type: boolean
          example: false

    MessageSendRequest:
      type: object
      properties:
        content:
          type: string
          example: "Thanks! Can we meet at the library front desk?"
      required: [content]

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT